<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.finco.user.users.mapper.UserMapper">

    <!-- email 컬럼은 BYTEA(암호문).
         '중복 체크'를 하려면 여기서 넘어오는 #{email}도 반드시 같은 방식으로 암호화된 byte[]여야 함 -->
    <select id="existsByEmail" resultType="int">
        SELECT COUNT(1)
        FROM finco_user
        WHERE email = #{email}
          AND deleted_at IS NULL
    </select>

    <!-- phone_number도 동일 -->
    <select id="existsByPhone" resultType="int">
        SELECT COUNT(1)
        FROM finco_user
        WHERE phone_number = #{phoneNumber}
          AND deleted_at IS NULL
    </select>

    <insert id="insertUser">
        INSERT INTO finco_user (
        user_id,
        user_name,
        password_hash,
        email,
        phone_number,
        status,
        failed_login_count,
        create_date,
        role
        ) VALUES (
        #{userId}::uuid,
        #{userName},
        #{passwordHash},
        #{email},         <!-- bytea -->
        #{phoneNumber},   <!-- bytea -->
        'ACTIVE',
        0,
        NOW(),
        'USER'
        )
    </insert>

</mapper>
